<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPS Calculator Pro 2.0</title>
    <style>
        :root { --accent: #00ff88; --bg: #121212; --panel: #1e1e1e; --text: #e0e0e0; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; }
        
        .container { width: 100%; max-width: 700px; background: var(--panel); padding: 40px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.6); border: 1px solid #333; }
        
        h1 { text-align: center; color: var(--accent); margin-bottom: 30px; text-transform: uppercase; letter-spacing: 2px; }
        
        .control-group { margin-bottom: 25px; position: relative; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9em; color: #aaa; }
        
        /* Stile Input Ricerca e Select */
        input[type="text"] {
            width: 100%; padding: 12px; margin-bottom: 5px; 
            background: #2a2a2a; border: 1px solid #444; border-radius: 8px; 
            color: #fff; font-size: 15px; box-sizing: border-box; font-weight: bold;
        }
        input[type="text"]:focus { outline: none; border-color: var(--accent); background: #333; }

        select { 
            width: 100%; padding: 10px; background: #252525; border: 1px solid #444; 
            border-radius: 8px; color: #ccc; font-size: 14px; cursor: pointer; appearance: none;
            overflow-y: auto; /* Scrollbar più carina */
        }
        
        select option { padding: 8px; border-bottom: 1px solid #333; }
        select option:checked { background-color: var(--accent); color: #121212; font-weight: bold; }
        select:focus { outline: none; border-color: var(--accent); }

        /* Bottone */
        button { 
            width: 100%; padding: 18px; margin-top: 20px; 
            background: linear-gradient(45deg, #00ff88, #00cc6a); 
            color: #121212; font-weight: 800; font-size: 18px; border: none; 
            border-radius: 10px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 255, 136, 0.3); }

        /* Risultati */
        .result-box { 
            margin-top: 40px; padding: 20px; background: #252525; border-radius: 15px; 
            text-align: center; display: none; border: 1px solid #444; animation: fadeIn 0.5s;
        }
        .fps-number { font-size: 5em; font-weight: 900; color: var(--accent); line-height: 1; }
        .fps-label { font-size: 1.2em; color: #fff; margin-bottom: 10px; }
        .bottleneck-msg { color: #ff5555; font-size: 0.95em; margin-top: 15px; background: rgba(255, 85, 85, 0.1); padding: 10px; border-radius: 8px;}
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); }}
    </style>
</head>
<body>

<div class="container">
    <h1>⚡ FPS Calculator 2.0</h1>
    
    <div class="control-group">
        <label>1. SELEZIONA GIOCO</label>
        <input type="text" id="searchGame" placeholder="Cerca gioco (es. Cyberpunk)..." 
               onkeyup="filterSelect('searchGame', 'gameSelect')" 
               onkeydown="checkEnter(event, 'gameSelect', 'searchGame')">
        
        <select id="gameSelect" size="5" onclick="updateInput('gameSelect', 'searchGame')"></select>
    </div>

    <div class="control-group">
        <label>2. IL TUO PROCESSORE (CPU)</label>
        <input type="text" id="searchCpu" placeholder="Cerca CPU (es. i7, Ryzen)..." 
               onkeyup="filterSelect('searchCpu', 'cpuSelect')"
               onkeydown="checkEnter(event, 'cpuSelect', 'searchCpu')">
               
        <select id="cpuSelect" size="4" onclick="updateInput('cpuSelect', 'searchCpu')"></select>
    </div>

    <div class="control-group">
        <label>3. LA TUA SCHEDA VIDEO (GPU)</label>
        <input type="text" id="searchGpu" placeholder="Cerca GPU (es. 4070, 3060)..." 
               onkeyup="filterSelect('searchGpu', 'gpuSelect')"
               onkeydown="checkEnter(event, 'gpuSelect', 'searchGpu')">
               
        <select id="gpuSelect" size="4" onclick="updateInput('gpuSelect', 'searchGpu')"></select>
    </div>

    <div class="control-group">
        <label>4. RISOLUZIONE & QUALITÀ SCHERMO</label>
        <select id="resSelect">
            <option value="1.0">1080p - Full HD (1920x1080)</option>
            <option value="1.11">1200p - FHD+ 16:10 (1920x1200) [Laptop]</option>
            <option value="1.77">1440p - 2K QHD (2560x1440)</option>
            <option value="1.97">1600p - 2.5K QHD+ (2560x1600) [Legion/ROG]</option>
            <option value="2.25">Ultrawide 1440p (3440x1440)</option>
            <option value="4.0">2160p - 4K UHD (3840x2160)</option>
        </select>
    </div>

    <button onclick="calcolaFPS()">CALCOLA FPS REALI</button>

    <div class="result-box" id="resultBox">
        <div class="fps-label">FPS Stimati</div>
        <div class="fps-number" id="fpsOutput">0</div>
        <div class="bottleneck-msg" id="bottleneckOutput"></div>
    </div>
</div>

<script>
    let db = {};
    let originalOptions = {};

    // CARICAMENTO DB
    fetch('db.json')
        .then(response => response.json())
        .then(data => {
            db = data;
            popolaCpu(data.cpus);
            popolaGenerico('gpuSelect', data.gpus);
            popolaGenerico('gameSelect', data.games);
            
            salvaOpzioni('cpuSelect');
            salvaOpzioni('gpuSelect');
            salvaOpzioni('gameSelect');
        })
        .catch(err => alert("Errore caricamento db.json. Assicurati di aver eseguito il file Python!"));

    function popolaCpu(items) {
        const select = document.getElementById('cpuSelect');
        const amdGroup = document.createElement('optgroup'); amdGroup.label = "AMD RYZEN";
        const intelGroup = document.createElement('optgroup'); intelGroup.label = "INTEL CORE";

        items.forEach(item => {
            let opt = document.createElement('option');
            opt.value = item.score;
            opt.textContent = item.name;
            if(item.brand === "AMD") amdGroup.appendChild(opt);
            else intelGroup.appendChild(opt);
        });
        select.appendChild(amdGroup);
        select.appendChild(intelGroup);
        select.selectedIndex = 0;
    }

    function popolaGenerico(id, items) {
        const select = document.getElementById(id);
        items.forEach(item => {
            let opt = document.createElement('option');
            opt.value = item.score || JSON.stringify(item);
            opt.textContent = item.name;
            
            if(item.req_gpu) {
                opt.setAttribute('data-req-gpu', item.req_gpu);
                opt.setAttribute('data-req-cpu', item.req_cpu);
                opt.setAttribute('data-opt', item.opt);
            }
            select.appendChild(opt);
        });
        select.selectedIndex = 0;
    }

    function salvaOpzioni(id) {
        const select = document.getElementById(id);
        originalOptions[id] = Array.from(select.options);
    }

    function filterSelect(inputId, selectId) {
        const filter = document.getElementById(inputId).value.toUpperCase();
        const select = document.getElementById(selectId);
        const options = originalOptions[selectId];
        
        select.innerHTML = ""; 

        let count = 0;
        options.forEach(opt => {
            if (opt.text.toUpperCase().indexOf(filter) > -1) {
                select.appendChild(opt.cloneNode(true));
                count++;
            }
        });

        if(count === 0) {
            let noResult = document.createElement('option');
            noResult.text = "Nessun risultato...";
            select.appendChild(noResult);
        } else {
            select.selectedIndex = 0; // Pre-seleziona il primo risultato
        }
    }

    // --- NUOVE FUNZIONI PER INTERAZIONE MIGLIORE ---

    // 1. Quando clicchi su una riga, aggiorna la barra di ricerca
    function updateInput(selectId, inputId) {
        const select = document.getElementById(selectId);
        const input = document.getElementById(inputId);
        if (select.selectedIndex !== -1) {
            input.value = select.options[select.selectedIndex].text;
        }
    }

    // 2. Quando premi ENTER nella casella di testo
    function checkEnter(event, selectId, inputId) {
        if (event.key === "Enter") {
            const select = document.getElementById(selectId);
            if (select.options.length > 0) {
                select.selectedIndex = 0; // Forza selezione del primo elemento
                updateInput(selectId, inputId); // Copia testo
                document.getElementById(inputId).blur(); // Toglie il focus
            }
        }
    }

    // --- FINE NUOVE FUNZIONI ---

    function calcolaFPS() {
        const cpuScore = parseInt(document.getElementById('cpuSelect').value);
        const gpuScore = parseInt(document.getElementById('gpuSelect').value);
        const resFactor = parseFloat(document.getElementById('resSelect').value);
        
        const gameSel = document.getElementById('gameSelect');
        const gameOpt = gameSel.options[gameSel.selectedIndex];
        
        if(!gameOpt || !gameOpt.hasAttribute('data-req-gpu')) return alert("Seleziona un gioco valido!");

        const reqGpu = parseFloat(gameOpt.getAttribute('data-req-gpu'));
        const reqCpu = parseFloat(gameOpt.getAttribute('data-req-cpu'));
        const gameOptimization = parseFloat(gameOpt.getAttribute('data-opt'));

        // 1. Calcolo potenza grezza (Ratio)
        let potenzialeGpu = gpuScore / reqGpu;
        let potenzialeCpu = cpuScore / reqCpu;

        // 2. Identificazione del Collo di Bottiglia (Bottleneck)
        let pesoGpu = (resFactor >= 1.7) ? 0.85 : 0.6; 
        
        let rawPerformance = 0;
        let bottleneckMsg = "";

        // Logica realistica: Le prestazioni sono dettate dal componente più lento
        if (potenzialeGpu < potenzialeCpu) {
            rawPerformance = potenzialeGpu;
            bottleneckMsg = "⚠️ Limite: GPU (Scheda Video al 100%)";
        } else {
            rawPerformance = potenzialeCpu;
            bottleneckMsg = "⚠️ Limite: CPU (Processore al limite)";
        }

        // 3. FORMULA DEI RENDIMENTI DECRESCENTI (La parte importante!)
        // Base FPS teorici (60 fps è il target dei requisiti raccomandati)
        let baseFPS = 60 * rawPerformance;

        // Applichiamo la risoluzione
        let fps = baseFPS / Math.sqrt(resFactor);
        
        // Applichiamo l'ottimizzazione del motore grafico
        fps = fps * gameOptimization;

        // 4. CURVA DI REALISMO (Soft Cap)
        // Se gli FPS superano i 144, l'hardware fa fatica a spingere oltre linearmente.
        // Simuliamo i limiti del motore di gioco.
        if (fps > 144) {
            // Tutto ciò che è sopra 144 viene dimezzato (più difficile salire)
            fps = 144 + (fps - 144) * 0.5;
        }
        if (fps > 240) {
            // Tutto ciò che è sopra 240 viene diviso per 4 (quasi impossibile salire oltre)
            fps = 240 + (fps - 240) * 0.25;
        }

        // 5. Arrotondamento finale
        fps = Math.round(fps);
        
        // Limite massimo assoluto (engine cap)
        if(fps > 999) fps = 999; 

        // Visualizzazione
        document.getElementById('resultBox').style.display = 'block';
        document.getElementById('fpsOutput').innerText = fps;
        
        // Aggiungiamo un colore al bottleneck per renderlo figo
        const msgElement = document.getElementById('bottleneckOutput');
        msgElement.innerText = bottleneckMsg;
        if(fps < 60) {
            msgElement.style.color = "#ff5555"; // Rosso se pochi FPS
        } else {
            msgElement.style.color = "#00ff88"; // Verde se ok
        }
    }
</script>

</body>
</html>

